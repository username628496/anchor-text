<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anchor Text Creator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background-color: #FAF9F6; color: black; font-family: system-ui, sans-serif; }
    .history-entry { border-bottom: 1px solid #d1d5db; padding: 5px 0; border-radius: 0.375rem; }
    .toggle-details { cursor: pointer; color: #3b82f6; font-size: 0.9rem; }
    .history-box { border-bottom: 1px solid #d1d5db; border-radius: 0.375rem; }
    .history-icon { color: #6b7280; }
  </style>
</head>
<body class="bg-[#FAF9F6] text-black font-[system-ui,sans-serif]">
  <header class="flex items-center space-x-2 text-2xl font-semibold px-6 py-4 bg-white text-black">
    <h1>‚öì <span class="text-red-600">Anchor Text Creator v2</span></h1>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div>
        <label class="font-semibold block mb-1">Nh·∫≠p Anchors</label>
        <textarea id="anchorInput" class="border border-gray-300 rounded-md px-3 py-2 w-full font-mono h-64"></textarea>
      </div>
      <div>
        <label class="font-semibold block mb-1">Nh·∫≠p URLs</label>
        <textarea id="urlInput" class="border border-gray-300 rounded-md px-3 py-2 w-full font-mono h-64"></textarea>
      </div>
    </div>

    <label class="inline-flex items-center mb-4">
      <input type="checkbox" id="targetBlank" class="mr-2" />
      <span>Th√™m <code>target="_blank"</code></span>
    </label>

    <div class="space-x-2 mb-6">
      <button onclick="generateLinks()" class="rounded-md border px-4 py-2 font-medium shadow-sm bg-white border-gray-300">T·∫°o Anchor Text</button>
      <button onclick="exportHtml()" class="rounded-md border px-4 py-2 font-medium shadow-sm bg-green-600 text-white border-green-600">Xu·∫•t HTML</button>
    </div>

    <p id="warningMessage" class="text-red-400 font-semibold mb-4"></p>

    <section class="mb-6 bg-white border border-gray-300 rounded-md p-4">
      <h3 class="text-lg font-semibold mb-2">Anchor Text Ki·ªÉu 1</h3>
      <div class="output-box overflow-x-auto whitespace-nowrap" id="anchorWithPipes"></div>
      <button onclick="copyDivContent('anchorWithPipes')" class="mt-2 rounded-md border px-4 py-2 font-medium shadow-sm bg-white border-gray-300">Copy</button>
    </section>

    <section class="mb-6 bg-white border border-gray-300 rounded-md p-4">
      <h3 class="text-lg font-semibold mb-2">Anchor Text Ki·ªÉu 2</h3>
      <div class="output-box overflow-x-auto whitespace-nowrap" id="anchorWithSpaces"></div>
      <button onclick="copyDivContent('anchorWithSpaces')" class="mt-2 rounded-md border px-4 py-2 font-medium shadow-sm bg-white border-gray-300">Copy</button>
    </section>

    <section class="mb-10 bg-white border border-gray-300 rounded-md p-4 history-box text-sm">
      <h3 class="text-lg font-semibold mb-2 flex items-center gap-2"><span class="history-icon">üïò</span> L·ªãch S·ª≠ Thao T√°c</h3>
      <div id="historyLog"></div>
    </section>
  </main>

  <footer class="bg-gray-800 text-white text-center py-4">
    –ü –∏ —Ç–µ—Ä ¬© 2025
  </footer>

<script>
  function normalizeUrl(url) {
    url = url.trim();
    if (!/^https?:\/\//i.test(url)) {
      url = "https://" + url.replace(/^\/*/, "");
    }
    url = url.replace(/^http:(?!\/\/)/i, "http://");
    url = url.replace(/^https:(?!\/\/)/i, "https://");
    return url;
  }

  let history = JSON.parse(localStorage.getItem("anchorHistory")) || [];

  function generateLinks() {
    const anchors = document.getElementById("anchorInput").value.trim().split("\n");
    const urls = document.getElementById("urlInput").value.trim().split("\n");
    const targetBlank = document.getElementById("targetBlank").checked;

    const minLength = Math.min(anchors.length, urls.length);
    document.getElementById("warningMessage").innerText = anchors.length !== urls.length 
      ? `‚ö†Ô∏è Anchor: ${anchors.length}, URL: ${urls.length}. X·ª≠ l√Ω ${minLength} d√≤ng.` : "";

    let pipeLinks = "", spaceLinks = "", pairs = [];
    for (let i = 0; i < minLength; i++) {
      const anchor = anchors[i].trim();
      const url = normalizeUrl(urls[i].trim());
      let output = "";

      if (anchor.startsWith("http")) {
        output = url;
      } else {
        output = `<a href="${url}"${targetBlank ? ' target="_blank"' : ''}>${anchor}</a>`;
      }

      pipeLinks += output + (i < minLength -1 ? " | " : "");
      spaceLinks += output + " ";
      pairs.push({ anchor, url });
    }

    document.getElementById("anchorWithPipes").innerHTML = pipeLinks.trim();
    document.getElementById("anchorWithSpaces").innerHTML = spaceLinks.trim();

    const time = new Date().toLocaleTimeString();
    history.unshift({ time, pairs });
    if (history.length > 30) history = history.slice(0, 30);
    localStorage.setItem("anchorHistory", JSON.stringify(history));
    // Popup notification
    const popup = document.createElement("div");
    popup.innerText = `ƒê√£ t·∫°o ${minLength} anchor text!`;
    popup.className = "fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded shadow-lg animate-bounce";
    document.body.appendChild(popup);
    setTimeout(() => popup.remove(), 2000);
    renderHistory();
  }

  function renderHistory() {
    const container = document.getElementById("historyLog");
    container.innerHTML = "";
    history.forEach((entry, index) => {
      const div = document.createElement("div");
      div.className = "history-entry";
      const toggleId = `detail-${index}`;
      div.innerHTML = `<strong>${entry.time}</strong> - ${entry.pairs.length} anchor 
        <span class="toggle-details" onclick="toggleDetails('${toggleId}')">[Xem chi ti·∫øt]</span>
        <div id="${toggleId}" style="display:none; margin-top:5px;">
          ${entry.pairs.map(p => `‚Ä¢ ${p.anchor} ‚Üí ${p.url}`).join("<br>")}
        </div>`;
      container.appendChild(div);
    });
  }

  function toggleDetails(id) {
    const el = document.getElementById(id);
    el.style.display = el.style.display === "none" ? "block" : "none";
  }

  function copyDivContent(id) {
    const range = document.createRange();
    range.selectNode(document.getElementById(id));
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
    document.execCommand("copy");
    window.getSelection().removeAllRanges();
    // Popup notification
    const copiedText = document.getElementById(id).innerText;
    const count = copiedText.split(/\| |\n/).filter(t => t.trim()).length;
    const popup = document.createElement("div");
    popup.innerText = `ƒê√£ copy ${count} anchor text!`;
    popup.className = "fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg animate-bounce";
    document.body.appendChild(popup);
    setTimeout(() => popup.remove(), 2000);
  }

  function exportHtml() {
    const html = document.getElementById("anchorWithPipes").innerHTML + "<br><br>" +
                 document.getElementById("anchorWithSpaces").innerHTML;
    const blob = new Blob(["<html><body>" + html + "</body></html>"], { type: "text/html" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "anchor-links.html";
    link.click();
  }


  document.addEventListener("DOMContentLoaded", function () {
    renderHistory();
  });
</script>

</body>
</html>
